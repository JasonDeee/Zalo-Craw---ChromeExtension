<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Debug - Zalo Crawler</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: "Lexend", sans-serif;
        background: #f0f0f0;
      }
      .debug-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        border-color: #bee5eb;
      }
      button {
        padding: 0.5rem 1rem;
        margin: 0.25rem;
        border: none;
        border-radius: 4px;
        background: #007bff;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .CrawlerApp {
        width: 100%;
        height: 400px;
        border: 2px solid #007bff;
        border-radius: 5px;
        position: relative;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div class="debug-container">
      <h1>üîß Zalo Crawler Debug</h1>

      <div class="test-section info">
        <h3>üìã System Check</h3>
        <div id="systemCheck">Checking...</div>
      </div>

      <div class="test-section">
        <h3>üß™ Component Tests</h3>
        <button onclick="testSettingsManager()">Test SettingsManager</button>
        <button onclick="testRouter()">Test Router</button>
        <button onclick="testWelcomeComponent()">Test Welcome Component</button>
        <div id="testResults"></div>
      </div>

      <div class="test-section">
        <h3>üéØ SPA Container</h3>
        <div class="CrawlerApp" id="testApp"></div>
        <button onclick="initTestApp()">Initialize Test App</button>
        <button onclick="navigateToWelcome()">Navigate to Welcome</button>
        <button onclick="navigateToSettings()">Navigate to Settings</button>
        <button onclick="navigateToDependenceMode()">
          Navigate to DependenceMode
        </button>
      </div>
    </div>

    <!-- Load SPA Framework -->
    <script src="src/core/Component.js"></script>
    <script src="src/core/Router.js"></script>
    <script src="src/core/SettingsManager.js"></script>
    <script src="src/components/Welcome.js"></script>
    <script src="src/components/DependenceMode.js"></script>
    <script src="src/components/Settings.js"></script>
    <script src="src/core/App.js"></script>

    <script>
      // Component aliases
      class WelcomeComponent extends Welcome {}
      class SettingsComponent extends Settings {}
      class DependenceModeComponent extends DependenceMode {}

      // Placeholder components
      class PairedModeComponent extends BaseComponent {
        async mount() {
          this.element.innerHTML =
            '<div style="padding: 2rem; text-align: center;"><h2>Paired Mode</h2><p>Test component</p></div>';
        }
        setTemplatePath() {
          this.templatePath = null;
        }
        async loadTemplate() {
          this.element = document.createElement("div");
          this.element.className = "paired-mode-component component";
          return "";
        }
      }

      class AboutComponent extends BaseComponent {
        async mount() {
          this.element.innerHTML =
            '<div style="padding: 2rem; text-align: center;"><h2>About</h2><p>Test component</p></div>';
        }
        setTemplatePath() {
          this.templatePath = null;
        }
        async loadTemplate() {
          this.element = document.createElement("div");
          this.element.className = "about-component component";
          return "";
        }
      }

      let testRouter = null;
      let testApp = null;

      // System check
      function systemCheck() {
        const results = [];

        // Check if classes are loaded
        results.push(
          `BaseComponent: ${typeof BaseComponent !== "undefined" ? "‚úÖ" : "‚ùå"}`
        );
        results.push(`Router: ${typeof Router !== "undefined" ? "‚úÖ" : "‚ùå"}`);
        results.push(
          `SettingsManager: ${
            typeof window.settingsManager !== "undefined" ? "‚úÖ" : "‚ùå"
          }`
        );
        results.push(
          `Welcome: ${typeof Welcome !== "undefined" ? "‚úÖ" : "‚ùå"}`
        );
        results.push(
          `DependenceMode: ${
            typeof DependenceMode !== "undefined" ? "‚úÖ" : "‚ùå"
          }`
        );
        results.push(
          `Settings: ${typeof Settings !== "undefined" ? "‚úÖ" : "‚ùå"}`
        );
        results.push(`App: ${typeof App !== "undefined" ? "‚úÖ" : "‚ùå"}`);

        document.getElementById("systemCheck").innerHTML = results.join("<br>");
      }

      function testSettingsManager() {
        const results = [];
        try {
          // Test basic functionality
          window.settingsManager.set("testKey", "testValue");
          const value = window.settingsManager.get("testKey");
          results.push(`Set/Get: ${value === "testValue" ? "‚úÖ" : "‚ùå"}`);

          // Test token generation
          const token = window.settingsManager.generateNewToken();
          results.push(
            `Generate Token: ${token && token.length === 16 ? "‚úÖ" : "‚ùå"}`
          );

          // Test settings summary
          const summary = window.settingsManager.getSettingsSummary();
          results.push(
            `Settings Summary: ${
              summary && typeof summary === "object" ? "‚úÖ" : "‚ùå"
            }`
          );
        } catch (error) {
          results.push(`‚ùå Error: ${error.message}`);
        }

        document.getElementById("testResults").innerHTML =
          '<div class="success">SettingsManager Tests:<br>' +
          results.join("<br>") +
          "</div>";
      }

      function testRouter() {
        const results = [];
        try {
          const router = new Router("#testApp");
          router.register("/test", WelcomeComponent);
          results.push(`Router Creation: ‚úÖ`);
          results.push(`Route Registration: ‚úÖ`);
        } catch (error) {
          results.push(`‚ùå Error: ${error.message}`);
        }

        document.getElementById("testResults").innerHTML =
          '<div class="info">Router Tests:<br>' +
          results.join("<br>") +
          "</div>";
      }

      function testWelcomeComponent() {
        const results = [];
        try {
          const welcome = new WelcomeComponent();
          results.push(`Welcome Component Creation: ‚úÖ`);
          results.push(
            `Template Path: ${welcome.templatePath || "Inline Template"}`
          );

          // Test template loading
          welcome
            .loadTemplate()
            .then(() => {
              results.push(`Template Loading: ‚úÖ`);
              document.getElementById("testResults").innerHTML =
                '<div class="success">Welcome Component Tests:<br>' +
                results.join("<br>") +
                "</div>";
            })
            .catch((error) => {
              results.push(`‚ùå Template Loading Error: ${error.message}`);
              document.getElementById("testResults").innerHTML =
                '<div class="error">Welcome Component Tests:<br>' +
                results.join("<br>") +
                "</div>";
            });
        } catch (error) {
          results.push(`‚ùå Error: ${error.message}`);
          document.getElementById("testResults").innerHTML =
            '<div class="error">Welcome Component Tests:<br>' +
            results.join("<br>") +
            "</div>";
        }
      }

      async function initTestApp() {
        try {
          testRouter = new Router("#testApp");
          window.router = testRouter;

          // Register routes
          testRouter.register("/welcome", WelcomeComponent);
          testRouter.register("/settings", SettingsComponent);
          testRouter.register("/dependence-mode", DependenceModeComponent);
          testRouter.register("/paired-mode", PairedModeComponent);
          testRouter.register("/about", AboutComponent);

          document.getElementById("testResults").innerHTML =
            '<div class="success">‚úÖ Test Router Initialized</div>';
        } catch (error) {
          document.getElementById("testResults").innerHTML =
            '<div class="error">‚ùå Error: ' + error.message + "</div>";
        }
      }

      async function navigateToWelcome() {
        if (!testRouter) {
          await initTestApp();
        }
        try {
          await testRouter.navigate("/welcome");
          document.getElementById("testResults").innerHTML =
            '<div class="success">‚úÖ Navigated to Welcome</div>';
        } catch (error) {
          document.getElementById("testResults").innerHTML =
            '<div class="error">‚ùå Navigation Error: ' +
            error.message +
            "</div>";
        }
      }

      async function navigateToSettings() {
        if (!testRouter) {
          await initTestApp();
        }
        try {
          await testRouter.navigate("/settings");
          document.getElementById("testResults").innerHTML =
            '<div class="success">‚úÖ Navigated to Settings</div>';
        } catch (error) {
          document.getElementById("testResults").innerHTML =
            '<div class="error">‚ùå Navigation Error: ' +
            error.message +
            "</div>";
        }
      }

      async function navigateToDependenceMode() {
        if (!testRouter) {
          await initTestApp();
        }
        try {
          await testRouter.navigate("/dependence-mode");
          document.getElementById("testResults").innerHTML =
            '<div class="success">‚úÖ Navigated to DependenceMode</div>';
        } catch (error) {
          document.getElementById("testResults").innerHTML =
            '<div class="error">‚ùå Navigation Error: ' +
            error.message +
            "</div>";
        }
      }

      // Run system check on load
      document.addEventListener("DOMContentLoaded", systemCheck);
    </script>
  </body>
</html>
